<ual-message-banner ng-show="vm.messageDisplayed" class="-dashboard" config="vm.saveResultMessage">
</ual-message-banner>

<div class="report-header">
    <div class="title">
        <span ng-hide="vm.report.reportId.get() ">Create </span>
        <span ng-show="vm.report.reportId.get() ">Modify </span>
        Report
    </div>
    <ual-button class="save-button -secondary" ng-disabled="(vm.report.variables.get() | isEmpty)||(vm.report.datasource.get().name | isEmpty)" ng-click="vm.saveReport(vm.report)">Save</ual-button>
</div>
<div class="report-body">
    <div class="section report-name">
        <ual-report-input report="vm.report" ></ual-report-input>
        <div class="title">Insert a Report Name</div>
    </div>
    <div class="section selected-parameters">
        <div class="selected-parameter">
          <span class="title">Data Source:</span>
          <span class="value">{{vm.report.datasource.get().name}}</span>
          <a class="action" href ng-click="vm.selectDataSource()">Change Data Source</a>
        </div>
        <div class="selected-parameter">
          <span class="title">Variables:</span>
          <span class="value" ng-show="vm.report.variables.get() | isEmpty">No Variables Selected</span>
          <span class="value" ng-hide="vm.report.variables.get() | isEmpty">{{vm.report.variables.get().length}} Variables Selected</span>
          <a class="action" href ng-click="vm.selectVariables()">Manage Variables</a>
        </div>
    </div>
    <div class="section aggregations-values">
        <div class="aggregation-search">
                <span class="-label">Aggregate by</span>
                <ual-input on-focus="vm.showDropdown()" on-blur="vm.hideDropDown()" ng-style="vm.inputStyle" value="vm.search.name" icon="ion-ios-search-strong">
                    <ual-dropdown filter='vm.search'ng-style="vm.dropDownStyle">
                        <ual-dropdown-messages>
                            <span class="-max-reached" ng-if="vm.report.aggregators.get().length >= vm.maxAggregators">
                                <i class="-icon-warning"></i> You have reached the limit of 10 aggregators
                            </span>
                            <span class="-no-result" ng-if="vm.aggregators.items | filter: vm.search | isEmpty">
                                No results match your search
                            </span>
                        </ual-dropdown-messages>
                        <ual-dropdown-items ual-scroll ual-scroll-options="{ theme:'dark' }" ng-if="vm.aggregators.groups" ng-class="{'-no-results': (vm.aggregators.items | filter: vm.search | isEmpty) }">
                            <ual-dropdown-group name="{{group.name}}" ng-repeat="group in vm.aggregators.groups" ng-if="!(group.items | filter: vm.search | isEmpty)">
                                <ual-dropdown-item ng-click="vm.addAggregator(item)" name="{{item.name}}" ng-repeat="item in group.items | filter: vm.search" ng-class="{'-disabled': vm.isAggregated(item)}">
                                </ual-dropdown-item>
                            </ual-dropdown-group>
                        </ual-dropdown-items>
                    </ual-dropdown>
                </ual-input>
        </div>
        <div class="aggregation-items">
            <div class="aggregated-container">
                <ual-agregation-item ng-repeat="item in vm.report.aggregators.get()">{{item.name}}</ual-agregation-item>
            </div>
        </div>
    </div>
</div>
