<div class="dashboard-header">
  <form class="name" ng-submit="vm.saveName()">
    <ual-report-input id="report-name" class="name-input"
      ng-class="{'-noborder': !(vm.name.hover || vm.name.focus), '-empty': (!vm.name.current || !vm.report.name.get()), '-error': vm.name.duplicated}"
      placeholder="Enter report name"
      ual-value="vm.name.current"
      ng-mouseover="vm.hoverName()" ng-mouseleave="vm.leaveName()"
      on-focus="vm.focusName()" on-blur="vm.saveName()" ></ual-report-input>
    <span class="duplicate-error" ng-show="vm.name.duplicated">Report name already exists. Please select another.</span>
  </form>
  <div class="buttons-group">
    <ual-button class="save-button -secondary" loading="{{vm.isSaving}}" ng-disabled="!vm.report.datasource.get() || vm.isSaving" ng-click="vm.save()">Save</ual-button>
    <ual-button class="copy-button -secondary" ng-disabled="true">Create a copy</ual-button>
  </div>
</div>
<div class="dashboard-body">
  <ual-accordion-group selected="vm.selectedTab">
    <ual-accordion id="report-datasource" ng-disabled="false">
      <ual-accordion-title>Data source:
        <strong>{{ vm.report.datasource.get() ? vm.report.datasource.get().name : 'No data source' }}</strong>
        <small>{{ vm.report.datasource.get() ? 'Last updated ' + (vm.report.datasource.get().refreshDate | date:'MM/dd/yy HH:mm':'-0500') + ' CT' : 'selected' }}</small></ual-accordion-title>
      <ual-accordion-content>
        <ual-data-source on-change="vm.onChangeDataSource()" selected="vm.report.datasource" has-variables="vm.hasVariables()">
        </ual-data-source>
      </ual-accordion-content>
    </ual-accordion>
    <ual-accordion id="report-variables" ng-disabled="!vm.report.datasource.get()">
      <ual-accordion-title>Variables:
        <strong>
          {{vm.report.aggregators.get().length >0 ? vm.report.aggregators.get().length : 'No'}} aggregators and
          {{vm.report.variables.get().length > 0? vm.report.variables.get().length: 'no'}} variables
        </strong>
        <small>selected</small>
      </ual-accordion-title>
      <ual-accordion-content>
        <ual-variables-layout class="ual-variables-layout" variables="vm.report.variables" aggregators="vm.report.aggregators" datasource="vm.report.datasource.get()"></ual-variables-layout>
      </ual-accordion-content>
    </ual-accordion>
    <ual-accordion id="report-filters" ng-disabled="!vm.report.datasource.get()">
      <ual-accordion-title>Limits: <strong><span ng-show="!vm.report.filters.hasValues()">No limits</span> <span ng-show="vm.report.filters.hasValues()">Limits</span> </strong><small>selected</small></ual-accordion-title>
      <ual-accordion-content>
        <ual-filters datasource="vm.report.datasource.get()" filters="vm.report.filters"></ual-filters>
      </ual-accordion-content>
    </ual-accordion>
  </ual-accordion-group>
  <div class="run-section">
    <ual-button class="run-button -primary" ng-disabled="true">Run report</ual-button>
  </div>
</div>
