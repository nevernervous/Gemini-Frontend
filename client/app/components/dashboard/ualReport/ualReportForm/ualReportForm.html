<div class="header-dashboard"
  layout="row"
  layout-align="space-between center">
  <form name="nameForm" class="name" ng-submit="vm.saveName()">
    <ual-report-input id="report-name" class="name-input" ng-class="{'-noborder': !(vm.name.hover || vm.name.focus), '-empty': (!vm.name.current || !vm.report.name.get()), '-error': vm.name.duplicated}" placeholder="Enter report name" ual-value="vm.name.current"
      ng-mouseover="vm.hoverName()" ng-mouseleave="vm.leaveName()" on-focus="vm.focusName()" on-blur="vm.saveName()"></ual-report-input>
    <span class="duplicate-error" ng-show="vm.name.duplicated">Report name already exists. Please select another.</span>
  </form>
  <div class="buttons-group"
    layout="row">
    <md-button ual-button="secondary"
      ng-disabled="!vm.report.datasource.get() || vm.isSaving"
      ng-click="vm.save()">
      <ual-loading
        ual-loading-enable="vm.isSaving"
        ual-loading-diameter="20">
        Save
      </ual-loading>
    </md-button>
    <md-button ual-button="secondary"
      ng-disabled="true">
      Create a copy
    </md-button>
  </div>
</div>
<form layout="column"
  class="body-dashboard"
  name="reportForm"
  novalidate>
  <ual-accordion-group
    selected="vm.selectedTab">
    <ual-accordion id="report-datasource" ng-disabled="false">
      <ual-accordion-title>Data source:
        <strong>{{ vm.report.datasource.get() ? vm.report.datasource.get().name : 'No data source' }}</strong>
        <small>{{ vm.report.datasource.get() ? 'Last updated ' + (vm.report.datasource.get().refreshDate | date:'MM/dd/yy HH:mm':'-0500') + ' CT' : 'selected' }}</small></ual-accordion-title>
      <ual-accordion-content layout="column">
        <ual-data-source layout="column" layout-fill
          on-change="vm.onChangeDataSource()"
          selected="vm.report.datasource"
          has-variables="vm.hasVariables()">
        </ual-data-source>
      </ual-accordion-content>
    </ual-accordion>
    <ual-accordion id="report-variables" ng-disabled="!vm.report.datasource.get()">
      <ual-accordion-title>Variables:
        <strong>
          {{vm.report.aggregators.get().length >0 ? vm.report.aggregators.get().length : 'No'}} aggregators and
          {{vm.report.variables.get().length > 0? vm.report.variables.get().length: 'no'}} variables
        </strong>
        <small>selected</small>
      </ual-accordion-title>
      <ual-accordion-content>
        <ual-variables-layout class="ual-variables-layout" variables="vm.report.variables" aggregators="vm.report.aggregators" datasource="vm.report.datasource.get()"></ual-variables-layout>
      </ual-accordion-content>
    </ual-accordion>
    <ual-accordion id="report-filters" ng-disabled="!vm.report.datasource.get()" class="-filters">
      <ual-accordion-title>Limits: <strong><span ng-show="!vm.report.filters.hasValues()">No limits</span> <span ng-show="vm.report.filters.hasValues()">Limits</span> </strong><small>selected</small></ual-accordion-title>
      <ual-accordion-content>
        <ual-filters datasource="vm.report.datasource.get()" filters="vm.report.filters"></ual-filters>
      </ual-accordion-content>
    </ual-accordion>
  </ual-accordion-group>
  <div layout="row" layout-align="end center"
    class="report-form-submit">
    <md-button ual-button
      type="submit"
      ng-disabled="!vm.enableRun()"
      ng-click="vm.runReport(reportForm)">
      Run report
    </md-button>
  </div>
</form>
